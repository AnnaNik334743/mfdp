# Cервис

### Как запустить сервис

*Можете попробовать открыть по ссылке http://158.160.105.217:8000/asr.*  

**Для самостоятельного запуска**

1. Перейти в директорию service.

2. Проверить установлен ли плагин Loki: 
    ``` 
    docker plugin -ls
    ```
3. Если **не** установлен, выполнить команду:
    ``` 
    docker plugin install grafana/loki-docker-driver:latest --alias loki --grant-all-permissions
    ```

4. На 157 строке файла .asr_app/templates/index.html заменить адрес на адрес свой машины.

5. Выполнить в командной строке следующие команды:
    ```
    docker-compose build
    docker-compose up -d
    ```

При запускаете сервис на удаленном сервере, чтобы получить доступ к записи с микрофона (для Google Chrome):
1. перейти в `chrome://flags/#unsafely-treat-insecure-origin-as-secure` 
2. добавить адрес своей машины вместе с портом, на котором находится сервис, в раздел `Insecure origins treated as secure`

Модель загружается после построения контейнера. Пока все еще загружается маленькая не файнтюниная модель.

-------

Иногда происходит какой-то сбой, Grafana при запуске не отображает данные, хотя источники данных добавляются по умолчанию. В этом случае помогает зайти в существующие источники данных в Grafana и каждый сохранить еще раз, ничего не меняя.

-------

Порты:
* 8000 - app
* 3000 - Grafana
* 8089 - Locust
* 9090 - Prometheus
* 3100 - Loki

-------


